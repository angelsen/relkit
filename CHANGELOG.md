# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added
- Stateful Context with `current_package` field and `with_package()` method for cleaner package management
- Context.package property that automatically resolves the current package
- Package parameter support for preflight, test, and check commands

### Changed
- **BREAKING**: Replaced `Optional[T]` with `T | None` syntax throughout (requires Python 3.10+)
- **BREAKING**: Removed redundant utility functions `resolve_package()` and `require_package_for_workspace()`
- **BREAKING**: All commands now use consistent package resolution through Context.package
- Simplified package resolution - set context once, use everywhere
- All safety decorators now properly handle package context

### Fixed
- Missing --package flag support for preflight, test, and check commands
- Inconsistent package parameter handling across commands and checks
- Review tokens now use consistent project-wide naming (not package-specific) so tokens work across all packages
- Type annotations for optional parameters (Dict[str, str] | None instead of Dict[str, str | None])
- Context not being set properly before package validation in several commands

### Removed
- Redundant package resolution utilities (functionality moved to Context)

## [1.5.4] - 2025-09-05

### Added

### Changed

### Fixed
- Git wrapper's Claude signature stripping was too aggressive, removing any line containing "claude" including legitimate commit scopes like `refactor(claude):`
- Made Claude signature removal more targeted to only remove actual footer signatures, not content

### Removed

## [1.5.3] - 2025-09-05

### Added

### Changed

### Fixed
- Git commit validation now strips leading/trailing whitespace from header line to handle shell formatting edge cases
- Type error in git wrapper resolved with defensive fallback message

### Removed

## [1.5.2] - 2025-09-04

### Added

### Changed
- Git wrapper refactored for zero stdout interference - wrapper commands now pass through cleanly
- CLI display split into wrapper and native modes for appropriate verbosity
- Removed TTY detection - tokens always go to stderr, user controls visibility
- Native commands simplified - no success checkmarks, minimal error prefixes

### Fixed
- Git wrapper no longer pollutes stdout, making it safe for piping and scripting
- Removed duplicate error messages - git's own errors stand alone
- Review tokens only generated when content exists

### Removed
- Success prefix markers (âœ“) from command output
- TTY detection for token generation

## [1.5.1] - 2025-08-14

### Added

### Changed

### Fixed
- Pass package parameter to check_version_tagged for workspace support
- Pass package parameter to check_dist_has_files in publish command  
- Add --all-extras flag to bump command sync for complete dependency resolution

### Removed

## [1.5.0] - 2025-08-13

### Added
- Full --package support for init-changelog and version commands
- New utility functions: parse_version, resolve_package, require_package_for_workspace
- Package-aware changelog system for all checks

### Changed
- Consolidated duplicate code into reusable utilities
- All changelog checks now support workspace packages
- Test command uses run_uv utility instead of direct subprocess
- Check command uses ruff utilities consistently

### Fixed
- Version command now properly shows workspace overview or package-specific version
- init-changelog creates CHANGELOG.md in correct package directory

### Removed
- Duplicate parse_version functions (consolidated to utils.py)
- Unused @workspace_aware decorator
- Unused check_version_tagged from git.py
- Redundant helper functions

## [1.4.0] - 2025-08-13

### Added
- `@requires_clean_dist` decorator that blocks build if dist/ contains files
- Full workspace awareness for all checks and commands
- Package properties: `dist_path`, `changelog_path`, `import_name` for cleaner code
- `WorkspaceContext.get_dist_path()` and `get_package_context()` utility methods
- `@workspace_aware` decorator for automatic package parameter handling

### Changed
- All distribution checks now support workspace packages
- Test command now uses package-specific dist paths
- Version and changelog checks handle package-specific files

### Fixed
- Critical bug: checks were using `ctx.root` instead of package-specific paths
- Build command now prevents mixing versions in dist/ directory

### Removed

## [1.3.0] - 2025-08-13

### Added
- Build token system for publish command to ensure integrity between build and publish
- `BUILD_PUBLISH` token generated by build command, valid for 30 minutes
- `check_build_token_valid` check to verify dist/ contents match what was built

### Changed

### Fixed

### Removed

## [1.2.0] - 2025-08-13

### Added
- Changelog compatibility check to detect and guide fixing of incompatible changelogs
- Clear instructions showing exactly where to add [Unreleased] section with line numbers
- Fail-fast behavior in status, check, and preflight commands for incompatible changelogs

### Changed

### Fixed

### Removed

## [1.1.1] - 2025-08-13

### Added

### Changed

### Fixed
- Correct tag naming for single vs workspace packages
- Resolve all type checking issues

### Removed

## [1.1.0] - 2025-08-13

### Added
- Comprehensive workspace support with per-package versioning
- Package-specific tagging (e.g., `termtap-v1.0.0`)
- `--package` flag for all major commands in workspace mode
- WorkspaceContext for unified single/workspace handling

### Changed
- Commands now require explicit `--package` selection for workspaces
- Refactored Context to WorkspaceContext with backward compatibility

### Fixed

### Removed

## [1.0.4] - 2025-08-13

### Added

### Changed
- Refactored: Cleaned up redundant code from module reorganization
- Improved: Simplified package structure for CLI-only tool

### Fixed
- Fixed entry point to use standard Python pattern

### Removed
- Removed deprecated backward compatibility aliases
- Removed empty checks/bump.py module

## [1.0.3] - 2025-08-13

### Added
- Two-phase lockfile handling in bump command to ensure lockfile is included in tagged commits

### Changed

### Fixed

### Removed

## [1.0.2] - 2025-08-13

### Added
- New check modules for better separation of concerns:
  - `checks/changelog.py` - Centralized changelog validation
  - `checks/version.py` - Version format, tagging, and progression checks
  - `checks/distribution.py` - Build and distribution file validation
- Enhanced `checks/git.py` with additional validation functions
- Comprehensive validation functions available to all commands

### Changed
- Refactored validation logic from commands to centralized check modules
- Improved separation of concerns - each check module owns its domain
- Updated all commands to use centralized checks instead of inline validation

### Fixed

### Removed

## [1.0.1] - 2025-08-13

### Added
- Changelog enforcement in bump command - blocks if commits exist but changelog is empty

### Changed

### Fixed
- Bump command now generates HOOK_OVERRIDE internally to handle pre-commit hook

### Removed

## [1.0.0] - 2025-08-13

### Added

### Changed
- **BREAKING**: Made `bump` command atomic - now handles version, changelog, commit, tag, and push in one operation
- Bump now requires clean git state (no uncommitted changes)

### Fixed

### Removed
- **BREAKING**: Removed standalone `tag` command - functionality merged into `bump`

## [0.1.2] - 2025-08-13

### Added
- Changelog version check in tag command to prevent re-releasing versions
- Remote repository requirement for tag creation
- Tag requirement for publishing to PyPI
- 60-second TTL for hook override system

### Changed
- Renamed project from uv-pm to relkit
- Updated description to "Opinionated release toolkit for modern Python projects"

### Fixed
- Type checking error display format (now uses proper dict structure)
- Pre-commit hook escape sequence warning

### Removed

## [0.1.1] - 2025-08-13

### Added
- Initial release of relkit - opinionated project manager for modern Python projects
- Complete release workflow management (bump, build, test, tag, publish)
- Git hooks for version management and conventional commits
- Comprehensive quality checks (formatting, linting, type checking)
- Safety tokens for destructive operations
- Support for single packages, workspaces, and hybrid projects
- PyPI publishing with configurable index URLs
- Automated changelog management

### Changed
- N/A (initial release)

### Fixed
- N/A (initial release)

### Removed
- N/A (initial release)

<!-- 
When you run 'relkit bump', the [Unreleased] section will automatically 
become the new version section. Make sure to add your changes above!
-->
